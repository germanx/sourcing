<%= form_for [@project], :html => { :multipart => true } do |f| %>
  <%= f.error_messages %>
  
  <fieldset>
    <% if @current_user.admin? %>
      <%= f.label :firm_id %>
      <%= f.collection_select(:firm_id, Firm.all, :id, :name) %>
    <% end %>

    <p>
      <%= f.label :name %>
      <%= f.text_field :name %>
    </p>

    <p>
      <%= f.label :state_id %>
      <%= f.collection_select(:state_id, State.all, :id, :name) %>
    </p>

    <div class="field">
      <%= f.text_area :description, placeholder: "Add description..." %>
    </div>

    <%= f.label :number %>
    <%= f.text_field :number %>

    <%= f.label :type_id %>
    <%= f.select :type_id, 
      [['Request for information',1], 
       ['Request for proposal',2],
       ['Request for quatation',3]] %>
  </fieldset>

  <fieldset> 
    <legend>Attachments</legend>
    <% number = 0 %>
    <div id='attachments'>
      <%= render :partial => "attachments/form", :locals => { :number => number } %>
    </div>
    <%= link_to "Add another attachment", 'javascript:', :id => "add_another_attachment" %> </fieldset>
  </fieldset>

  <fieldset> 
    <legend>Schedule</legend>
    <table>
    <thead>
      <th>Stage</th>
      <th>Date</th>
    </thead>
    <tbody>
      <%= f.fields_for :stages do |stage_field| %>
        <tr>
          <td><%= stage_field.object.state %></td>
          <td>
            <%= stage_field.text_field(
              :stage_start, 
              :value => stage_field.object.stage_start.to_date.to_s,
              :readonly => !stage_field.object.state.edit,
              :databehaviour => 'datepicker') %>
            <%= stage_field.hidden_field(:state_id) %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>

  </fieldset>


  <%= f.submit %>
<% end %>